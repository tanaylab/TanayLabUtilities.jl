
<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Matrix layouts · TanayLabUtilities.jl v0.1.0
</title>
<meta name="title" content="Matrix layouts · TanayLabUtilities.jl v0.1.0"/>
<meta property="og:title" content="Matrix layouts · TanayLabUtilities.jl v0.1.0"/>
<meta property="twitter:title" content="Matrix layouts · TanayLabUtilities.jl v0.1.0"/>
<meta name="description" content="Documentation for TanayLabUtilities.jl v0.1.0."/>
<meta property="og:description" content="Documentation for TanayLabUtilities.jl v0.1.0."/>
<meta property="twitter:description" content="Documentation for TanayLabUtilities.jl v0.1.0."/>
<script data-outdated-warner src="assets/warner.js">
</script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/>
<script>documenterBaseURL="."
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js">
</script>
<script src="search_index.js">
</script>
<script src="siteinfo.js">
</script>
<script src="../versions.js">
</script>
<link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/>
<link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/>
<link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/>
<link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/>
<link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/>
<link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/>
<script src="assets/themeswap.js">
</script>
</head>
<body>
<div id="documenter">
<nav class="docs-sidebar">
<div class="docs-package-name">
<span class="docs-autofit">
<a href="index.html">TanayLabUtilities.jl v0.1.0
</a>
</span>
</div>
<button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)
</button>
<ul class="docs-menu">
<li>
<a class="tocitem" href="index.html">TanayLabUtilities
</a>
</li>
<li>
<a class="tocitem" href="types.html">Types
</a>
</li>
<li>
<a class="tocitem" href="brief.html">Brief
</a>
</li>
<li>
<a class="tocitem" href="logger.html">Logger
</a>
</li>
<li>
<a class="tocitem" href="parallel_storage.html">Parallel Storage
</a>
</li>
<li>
<a class="tocitem" href="parallel_rng.html">ParallelRNG
</a>
</li>
<li>
<a class="tocitem" href="locks.html">Locks
</a>
</li>
<li>
<a class="tocitem" href="unique_names.html">Unique Names
</a>
</li>
<li>
<a class="tocitem" href="documentation.html">Documentation
</a>
</li>
<li>
<a class="tocitem" href="handlers.html">Handlers
</a>
</li>
<li>
<a class="tocitem" href="read_only_arrays.html">Read-Only Arrays
</a>
</li>
<li>
<a class="tocitem" href="downsample.html">Downsample
</a>
</li>
<li>
<a class="tocitem" href="cross_validations.html">Cross Validations
</a>
</li>
<li>
<a class="tocitem" href="global_weak_cache.html">Global Weak Cache
</a>
</li>
</ul>
<div class="docs-version-selector field has-addons">
<div class="control">
<span class="docs-label button is-static is-size-7">Version
</span>
</div>
<div class="docs-selector control is-expanded">
<div class="select is-fullwidth is-size-7">
<select id="documenter-version-selector">
</select>
</div>
</div>
</div>
</nav>
<div class="docs-main">
<header class="docs-navbar">
<a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#">
</a>
<nav class="breadcrumb">
<ul class="is-hidden-mobile">
<li class="is-active">
<a href="matrix_layouts.html">Matrix layouts
</a>
</li>
</ul>
<ul class="is-hidden-tablet">
<li class="is-active">
<a href="matrix_layouts.html">Matrix layouts
</a>
</li>
</ul>
</nav>
<div class="docs-right">
<a class="docs-navbar-link" href="https://github.com/tanaylab/TanayLabUtilities.jl/blob/main{path}?plain=1#L{line}" title="View the repository on GitHub">
<span class="docs-icon fa-brands">
</span>
<span class="docs-label is-hidden-touch">GitHub
</span>
</a>
<a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings">
</a>
<a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings">
</a>
</div>
</header>
<article class="content" id="documenter-page">
<h1 id="Matrix-layouts">
<a class="docs-heading-anchor" href="#Matrix-layouts">Matrix layouts
</a>
<a id="Matrix-layouts-1">
</a>
<a class="docs-heading-anchor-permalink" href="#Matrix-layouts" title="Permalink">
</a>
</h1>
<article class="docstring">
<header>
<a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring">
</a>
<a class="docstring-binding" id="TanayLabUtilities.MatrixLayouts" href="#TanayLabUtilities.MatrixLayouts">
<code>TanayLabUtilities.MatrixLayouts
</code>
</a> — 
<span class="docstring-category">Module
</span>
<span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring">
</span>
</header>
<section>
<div>
<p>Matrix data that has a clear layout, that is, a 
<a href="matrix_layouts.html#TanayLabUtilities.MatrixLayouts.major_axis">
<code>major_axis
</code>
</a>, regardless of whether it is dense or sparse.
</p>
<p>That is, for 
<a href="matrix_layouts.html#TanayLabUtilities.MatrixLayouts.Columns">
<code>Columns
</code>
</a>-major data, the values of each column are laid out consecutively in memory (each column is a single contiguous vector), so any operation that works on whole columns will be fast (e.g., summing the value of each column). In contrast, the values of each row are stored far apart from each other, so any operation that works on whole rows will be very slow in comparison (e.g., summing the value of each row).
</p>
<p>For 
<a href="matrix_layouts.html#TanayLabUtilities.MatrixLayouts.Rows">
<code>Rows
</code>
</a>-major data, the values of each row are laid out consecutively in memory (each row is a single contiguous vector). In contrast, the values of each column are stored far apart from each other. In this case, summing columns would be slow, and summing rows would be fast.
</p>
<p>This is much simpler than the 
<a href="https://github.com/JuliaLinearAlgebra/ArrayLayouts.jl">ArrayLayouts
</a> module which attempts to fully describe the layout of N-dimensional arrays, a much more ambitious goal which is an overkill for our needs.
</p>
<div class="admonition is-info" id="Note-f97ccd9ad5591d78">
<header class="admonition-header">Note
<a class="admonition-anchor" href="#Note-f97ccd9ad5591d78" title="Permalink">
</a>
</header>
<div class="admonition-body">
<p>The &quot;default&quot; layout in Julia is column-major, which inherits this from matlab, which inherits this from FORTRAN, allegedly because this is more efficient for some linear algebra operations. In contrast, most system languages and Python 
<code>numpy
</code> use row-major layout by default, because that&#39;s the sane layout (and generalizes better for tensors). At any rate, all systems work just fine with data of either memory layout; the key consideration is to keep track of the layout, and to apply operations &quot;with the grain&quot; rather than &quot;against the grain&quot; of the data.
</p>
</div>
</div>
</div>
</section>
</article>
<article class="docstring">
<header>
<a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring">
</a>
<a class="docstring-binding" id="TanayLabUtilities.MatrixLayouts.Rows" href="#TanayLabUtilities.MatrixLayouts.Rows">
<code>TanayLabUtilities.MatrixLayouts.Rows
</code>
</a> — 
<span class="docstring-category">Constant
</span>
<span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring">
</span>
</header>
<section>
<div>
<p>A symbolic name for the rows axis. It is more readable to write, say, 
<code>size(matrix, Rows)
</code>, instead of 
<code>size(matrix, 1)
</code>.
</p>
</div>
</section>
</article>
<article class="docstring">
<header>
<a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring">
</a>
<a class="docstring-binding" id="TanayLabUtilities.MatrixLayouts.Columns" href="#TanayLabUtilities.MatrixLayouts.Columns">
<code>TanayLabUtilities.MatrixLayouts.Columns
</code>
</a> — 
<span class="docstring-category">Constant
</span>
<span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring">
</span>
</header>
<section>
<div>
<p>A symbolic name for the rows axis. It is more readable to write, say, 
<code>size(matrix, Columns)
</code>, instead of 
<code>size(matrix, 2)
</code>.
</p>
</div>
</section>
</article>
<article class="docstring">
<header>
<a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring">
</a>
<a class="docstring-binding" id="TanayLabUtilities.MatrixLayouts.axis_name" href="#TanayLabUtilities.MatrixLayouts.axis_name">
<code>TanayLabUtilities.MatrixLayouts.axis_name
</code>
</a> — 
<span class="docstring-category">Function
</span>
<span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring">
</span>
</header>
<section>
<div>
<pre>
<code class="language-julia hljs">axis_name(axis::Maybe{Integer})::String
</code>
</pre>
<p>Return the name of the axis (for messages).
</p>
<pre>
<code class="language-julia hljs">println(axis_name(nothing))
println(axis_name(Rows))
println(axis_name(Columns))
println(axis_name(3))

# output

nothing
Rows
Columns
ERROR: invalid matrix axis: 3
</code>
</pre>
</div>
</section>
</article>
<article class="docstring">
<header>
<a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring">
</a>
<a class="docstring-binding" id="TanayLabUtilities.MatrixLayouts.major_axis" href="#TanayLabUtilities.MatrixLayouts.major_axis">
<code>TanayLabUtilities.MatrixLayouts.major_axis
</code>
</a> — 
<span class="docstring-category">Function
</span>
<span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring">
</span>
</header>
<section>
<div>
<pre>
<code class="language-julia hljs">major_axis(matrix::AbstractMatrix)::Maybe{Int8}
</code>
</pre>
<p>Return the index of the major axis of a matrix, that is, the axis one should keep 
<strong>fixed
</strong> for an efficient inner loop accessing the matrix elements. If the matrix doesn&#39;t support any efficient access axis, returns 
<code>nothing
</code>.
</p>
<pre>
<code class="language-julia hljs">using Test

base = [0 1 2; 3 4 0]

@test major_axis(base) == Columns

# Slice

@test major_axis(@view base[:, [1, 3, 2]]) == nothing

# Named

using NamedArrays

@test major_axis(NamedArray(base)) == Columns

# Permuted

permuted = PermutedDimsArray(base, (2, 1))
@test major_axis(permuted) == Rows

unpermuted = PermutedDimsArray(base, (1, 2))
@test major_axis(unpermuted) == Columns

# LinearAlgebra

transposed = transpose(base)
@test major_axis(transposed) == Rows

adjointed = adjoint(base)
@test major_axis(adjointed) == Rows

# Sparse

using SparseArrays

sparse = SparseMatrixCSC(base)
@test major_axis(sparse) == Columns

println(&quot;OK&quot;)

# output

OK
</code>
</pre>
</div>
</section>
</article>
<article class="docstring">
<header>
<a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring">
</a>
<a class="docstring-binding" id="TanayLabUtilities.MatrixLayouts.require_major_axis" href="#TanayLabUtilities.MatrixLayouts.require_major_axis">
<code>TanayLabUtilities.MatrixLayouts.require_major_axis
</code>
</a> — 
<span class="docstring-category">Function
</span>
<span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring">
</span>
</header>
<section>
<div>
<pre>
<code class="language-julia hljs">require_major_axis(matrix::AbstractMatrix)::Int8
</code>
</pre>
<p>Similar to 
<a href="matrix_layouts.html#TanayLabUtilities.MatrixLayouts.major_axis">
<code>major_axis
</code>
</a> but will 
<code>error
</code> if the matrix isn&#39;t in either row-major or column-major layout.
</p>
<pre>
<code class="language-julia hljs">using Test

base = [0 1 2; 3 4 0]

@test require_major_axis(base) == Columns

require_major_axis(@view base[:, [1, 3, 2]])

# output

ERROR: type: SubArray{Int64, 2, Matrix{Int64}, Tuple{Base.Slice{Base.OneTo{Int64}}, Vector{Int64}}, false} is not in any-major layout
</code>
</pre>
</div>
</section>
</article>
<article class="docstring">
<header>
<a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring">
</a>
<a class="docstring-binding" id="TanayLabUtilities.MatrixLayouts.minor_axis" href="#TanayLabUtilities.MatrixLayouts.minor_axis">
<code>TanayLabUtilities.MatrixLayouts.minor_axis
</code>
</a> — 
<span class="docstring-category">Function
</span>
<span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring">
</span>
</header>
<section>
<div>
<pre>
<code class="language-julia hljs">minor_axis(matrix::AbstractMatrix)::Maybe{Int8}
</code>
</pre>
<p>Return the index of the minor axis of a matrix, that is, the axis one should 
<strong>vary
</strong> for an efficient inner loop accessing the matrix elements. If the matrix doesn&#39;t support any efficient access axis, returns 
<code>nothing
</code>.
</p>
<pre>
<code class="language-julia hljs">using Test

base = [0 1 2; 3 4 0]

@test minor_axis(base) == Rows

# Slice

@test minor_axis(@view base[:, [1, 3, 2]]) == nothing

# Named

using NamedArrays

@test minor_axis(NamedArray(base)) == Rows

# Permuted

permuted = PermutedDimsArray(base, (2, 1))
@test minor_axis(permuted) == Columns

unpermuted = PermutedDimsArray(base, (1, 2))
@test minor_axis(unpermuted) == Rows

# LinearAlgebra

transposed = transpose(base)
@test minor_axis(transposed) == Columns

adjointed = adjoint(base)
@test minor_axis(adjointed) == Columns

# Sparse

using SparseArrays

sparse = SparseMatrixCSC(base)
@test minor_axis(sparse) == Rows

println(&quot;OK&quot;)

# output

OK
</code>
</pre>
</div>
</section>
</article>
<article class="docstring">
<header>
<a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring">
</a>
<a class="docstring-binding" id="TanayLabUtilities.MatrixLayouts.require_minor_axis" href="#TanayLabUtilities.MatrixLayouts.require_minor_axis">
<code>TanayLabUtilities.MatrixLayouts.require_minor_axis
</code>
</a> — 
<span class="docstring-category">Function
</span>
<span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring">
</span>
</header>
<section>
<div>
<pre>
<code class="language-julia hljs">require_minor_axis(matrix::AbstractMatrix)::Int8
</code>
</pre>
<p>Similar to 
<a href="matrix_layouts.html#TanayLabUtilities.MatrixLayouts.minor_axis">
<code>minor_axis
</code>
</a> but will 
<code>error
</code> if the matrix isn&#39;t in either row-major or column-major layout.
</p>
<pre>
<code class="language-julia hljs">using Test

base = [0 1 2; 3 4 0]

@test require_minor_axis(base) == Rows

require_minor_axis(@view base[:, [1, 3, 2]])

# output

ERROR: type: SubArray{Int64, 2, Matrix{Int64}, Tuple{Base.Slice{Base.OneTo{Int64}}, Vector{Int64}}, false} is not in any-major layout
</code>
</pre>
</div>
</section>
</article>
<article class="docstring">
<header>
<a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring">
</a>
<a class="docstring-binding" id="TanayLabUtilities.MatrixLayouts.other_axis" href="#TanayLabUtilities.MatrixLayouts.other_axis">
<code>TanayLabUtilities.MatrixLayouts.other_axis
</code>
</a> — 
<span class="docstring-category">Function
</span>
<span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring">
</span>
</header>
<section>
<div>
<pre>
<code class="language-julia hljs">other_axis(axis::Maybe{Integer})::Maybe{Int8}
</code>
</pre>
<p>Return the other 
<code>matrix
</code> 
<code>axis
</code> (that is, convert between 
<a href="matrix_layouts.html#TanayLabUtilities.MatrixLayouts.Rows">
<code>Rows
</code>
</a> and 
<a href="matrix_layouts.html#TanayLabUtilities.MatrixLayouts.Columns">
<code>Columns
</code>
</a>). If given 
<code>nothing
</code> returns 
<code>nothing
</code>.
</p>
<pre>
<code class="language-julia hljs">using Test

@test other_axis(nothing) == nothing
@test other_axis(Rows) == Columns
@test other_axis(Columns) == Rows

other_axis(3)

# output

ERROR: invalid matrix axis: 3
</code>
</pre>
</div>
</section>
</article>
<article class="docstring">
<header>
<a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring">
</a>
<a class="docstring-binding" id="TanayLabUtilities.MatrixLayouts.relayout!" href="#TanayLabUtilities.MatrixLayouts.relayout!">
<code>TanayLabUtilities.MatrixLayouts.relayout!
</code>
</a> — 
<span class="docstring-category">Function
</span>
<span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring">
</span>
</header>
<section>
<div>
<pre>
<code class="language-julia hljs">relayout!(destination::AbstractMatrix, source::AbstractMatrix)::AbstractMatrix
relayout!(destination::AbstractMatrix, source::NamedMatrix)::NamedMatrix
</code>
</pre>
<p>Return the same 
<code>matrix
</code> data, but in the other memory layout.
</p>
<p>Suppose you have a column-major UMIs matrix, whose rows are cells, and columns are genes. Therefore, looping on the UMIs of a gene will be fast, but looping on the UMIs of a cell will be slow. A 
<code>transpose
</code> (no 
<code>!
</code>) of a matrix is fast; it creates a zero-copy wrapper of the matrix with flipped axes, so its rows will be genes and columns will be cells, but in row-major layout. Therefore, 
<strong>still
</strong>, looping on the UMIs of a gene is fast, and looping on the UMIs of a cell is slow.
</p>
<p>In contrast, 
<code>transpose!
</code> (with a 
<code>!
</code>) (or 
<a href="matrix_layouts.html#TanayLabUtilities.MatrixLayouts.transposer">
<code>transposer
</code>
</a>) is slow; it creates a rearranged copy of the data, also returning a matrix whose rows are genes and columns are cells, but this time, in column-major layout. Therefore, in this case looping on the UMIs of a gene will be slow, and looping on the UMIs of a cell will be fast.
</p>
<div class="admonition is-info" id="Note-dcf00a86ddebf90f">
<header class="admonition-header">Note
<a class="admonition-anchor" href="#Note-dcf00a86ddebf90f" title="Permalink">
</a>
</header>
<div class="admonition-body">
<p>It is almost always worthwhile to 
<code>relayout!
</code> a matrix and then looping &quot;with the grain&quot; of the data, instead of skipping it and looping &quot;against the grain&quot; of the data. This is because (in Julia at least) the implementation of 
<code>transpose!
</code> is optimized for the task, while the other operations typically don&#39;t provide any specific optimizations for working &quot;against the grain&quot; of the data. The benefits of a 
<code>relayout!
</code> become more significant the more operations are done on the data in the loop.
</p>
</div>
</div>
<p>The 
<code>relayout!
</code> is essentially a zero-copy 
<code>transpose
</code> of the slow 
<code>transpose!
</code>. You end up with a matrix that 
<strong>appears
</strong> to be the same as the original (rows are cells and columns are genes), but behaves 
<strong>differently
</strong> - looping on the UMIs of a gene will be slow, and looping on the UMIs of a cell will be fast. In addition, 
<code>relayout!
</code> will work for both sparse and dense matrices. If the 
<code>source
</code> is a 
<code>NamedMatrix
</code>, then the result will be a 
<code>NamedMatrix
</code> with the same axes (zero-copy shared from the 
<code>source
</code>). If 
<code>destination
</code> is already a 
<code>NamedMatrix
</code>, then its axes must match 
<code>source
</code>.
</p>
<div class="admonition is-info" id="Note-4bcb4fcf75d941da">
<header class="admonition-header">Note
<a class="admonition-anchor" href="#Note-4bcb4fcf75d941da" title="Permalink">
</a>
</header>
<div class="admonition-body">
<p>The caller is responsible for providing a sensible 
<code>destination
</code> matrix (sparse for a sparse 
<code>source
</code>, dense for a non-sparse 
<code>source
</code>).
</p>
</div>
</div>
<pre>
<code class="language-julia hljs">using Test

using LinearAlgebra

source = rand(3, 4)
destination = transpose(rand(4, 3))

result = relayout!(destination, source)
@test result === destination
@test brief(source) == &quot;3 x 4 x Float64 in Columns (Dense)&quot;
@test brief(result) == &quot;3 x 4 x Float64 in Rows (Transpose, Dense)&quot;
@test result == source

# Named

using NamedArrays

named_source = NamedArray(rand(3, 4))
destination = transpose(rand(4, 3))
result = relayout!(destination, named_source)
@test parent(result) === destination
@test brief(named_source) == &quot;3 x 4 x Float64 in Columns (Named, Dense)&quot;
@test brief(result) == &quot;3 x 4 x Float64 in Rows (Named, Transpose, Dense)&quot;
@test result == named_source

source = rand(3, 4)
named_destination = NamedArray(transpose(rand(4, 3)))
result = relayout!(named_destination, source)
@test result === named_destination
@test brief(source) == &quot;3 x 4 x Float64 in Columns (Dense)&quot;
@test brief(result) == &quot;3 x 4 x Float64 in Rows (Named, Transpose, Dense)&quot;
@test result == source

source = rand(3, 4)
named_destination = Transpose(NamedArray(rand(4, 3)))
result = relayout!(named_destination, source)
@test result === named_destination
@test brief(source) == &quot;3 x 4 x Float64 in Columns (Dense)&quot;
@test brief(result) == &quot;3 x 4 x Float64 in Rows (Transpose, Named, Dense)&quot;
@test result == source

named_source = NamedArray(rand(3, 4))
named_destination = NamedArray(transpose(rand(4, 3)))
result = relayout!(named_destination, named_source)
@test result === named_destination
@test brief(named_source) == &quot;3 x 4 x Float64 in Columns (Named, Dense)&quot;
@test brief(result) == &quot;3 x 4 x Float64 in Rows (Named, Transpose, Dense)&quot;
@test result == named_source

# Permuted

source = rand(3, 4)
destination = PermutedDimsArray(rand(4, 3), (2,1))
result = relayout!(destination, source)
@test result === destination
@test brief(source) == &quot;3 x 4 x Float64 in Columns (Dense)&quot;
@test brief(result) == &quot;3 x 4 x Float64 in Rows (Permute, Dense)&quot;
@test result == source

source = rand(3, 4)
destination = PermutedDimsArray(adjoint(rand(4, 3)), (1,2))
result = relayout!(destination, source)
@test result === destination
@test brief(source) == &quot;3 x 4 x Float64 in Columns (Dense)&quot;
@test brief(result) == &quot;3 x 4 x Float64 in Rows (!Permute, Adjoint, Dense)&quot;
@test result == source

# Sparse

using SparseArrays

source = SparseMatrixCSC([0.0 1.0 2.0; 3.0 4.0 0.0])
destination = transpose(SparseMatrixCSC([30.0 0.0; 0.0 40.0; 20.0 10.0]))
result = relayout!(destination, source)
@test result === destination
@test brief(source) == &quot;2 x 3 x Float64 in Columns (Sparse Int64 67%)&quot;
@test brief(result) == &quot;2 x 3 x Float64 in Rows (Transpose, Sparse Int64 67%)&quot;
@test result == source

println(&quot;OK&quot;)

# output

OK
</code>
</pre>
</div>
</section>
</article>
<article class="docstring">
<header>
<a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring">
</a>
<a class="docstring-binding" id="TanayLabUtilities.MatrixLayouts.relayout" href="#TanayLabUtilities.MatrixLayouts.relayout">
<code>TanayLabUtilities.MatrixLayouts.relayout
</code>
</a> — 
<span class="docstring-category">Function
</span>
<span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring">
</span>
</header>
<section>
<div>
<pre>
<code class="language-julia hljs">relayout(matrix::AbstractMatrix)::AbstractMatrix
relayout(matrix::NamedMatrix)::NamedMatrix
</code>
</pre>
<p>Same as 
<a href="matrix_layouts.html#TanayLabUtilities.MatrixLayouts.relayout!">
<code>relayout!
</code>
</a> but allocates the destination matrix for you. Is equivalent to 
<code>transpose(transposer(matrix))
</code>.
</p>
<pre>
<code class="language-julia hljs">base = rand(3, 4)
@assert relayout(base) == base
@assert major_axis(relayout(base)) == minor_axis(base)

# output
</code>
</pre>
</div>
</section>
</article>
<article class="docstring">
<header>
<a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring">
</a>
<a class="docstring-binding" id="TanayLabUtilities.MatrixLayouts.transposer" href="#TanayLabUtilities.MatrixLayouts.transposer">
<code>TanayLabUtilities.MatrixLayouts.transposer
</code>
</a> — 
<span class="docstring-category">Function
</span>
<span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring">
</span>
</header>
<section>
<div>
<pre>
<code class="language-julia hljs">transposer(matrix::AbstractMatrix)::AbstractMatrix
</code>
</pre>
<p>Return a transpose of a matrix, but instead of simply using a zero-copy wrapper, it actually rearranges the data. See 
<a href="matrix_layouts.html#TanayLabUtilities.MatrixLayouts.relayout!">
<code>relayout!
</code>
</a>.
</p>
<pre>
<code class="language-julia hljs">using Test

# Dense

base = rand(3, 4)
@test transposer(base) == transpose(base)
@test brief(base) == &quot;3 x 4 x Float64 in Columns (Dense)&quot;
@test brief(transpose(base)) == &quot;4 x 3 x Float64 in Rows (Transpose, Dense)&quot;
@test brief(transposer(base)) == &quot;4 x 3 x Float64 in Columns (Dense)&quot;

# Named

using NamedArrays

base = NamedArray(rand(3, 4))
@test transposer(base) == transpose(base)
@test brief(base) == &quot;3 x 4 x Float64 in Columns (Named, Dense)&quot;
@test brief(transpose(base)) == &quot;4 x 3 x Float64 in Rows (Named, Transpose, Dense)&quot;
@test brief(transposer(base)) == &quot;4 x 3 x Float64 in Columns (Named, Dense)&quot;

# Permuted

base = PermutedDimsArray(rand(3, 4), (2,1))
@test transposer(base) == transpose(base)
@test brief(base) == &quot;4 x 3 x Float64 in Rows (Permute, Dense)&quot;
@test brief(transpose(base)) == &quot;3 x 4 x Float64 in Columns (Transpose, Permute, Dense)&quot;
@test brief(transposer(base)) == &quot;3 x 4 x Float64 in Rows (Transpose, Dense)&quot;

base = PermutedDimsArray(rand(3, 4), (1,2))
@test transposer(base) == transpose(base)
@test brief(base) == &quot;3 x 4 x Float64 in Columns (!Permute, Dense)&quot;
@test brief(transpose(base)) == &quot;4 x 3 x Float64 in Rows (Transpose, !Permute, Dense)&quot;
@test brief(transposer(base)) == &quot;4 x 3 x Float64 in Columns (Dense)&quot;

# LinearAlgebra

using LinearAlgebra

base = transpose(rand(3, 4))
@test transposer(base) == transpose(base)
@test brief(base) == &quot;4 x 3 x Float64 in Rows (Transpose, Dense)&quot;
@test brief(transpose(base)) == &quot;3 x 4 x Float64 in Columns (Dense)&quot;
@test brief(transposer(base)) == &quot;3 x 4 x Float64 in Rows (Transpose, Dense)&quot;

base = adjoint(rand(3, 4))
@test transposer(base) == transpose(base)
@test brief(base) == &quot;4 x 3 x Float64 in Rows (Adjoint, Dense)&quot;
@test brief(transpose(base)) == &quot;3 x 4 x Float64 in Columns (Dense)&quot;
@test brief(transposer(base)) == &quot;3 x 4 x Float64 in Rows (Adjoint, Dense)&quot;

# ReadOnly

base = read_only_array(rand(3, 4))
@test transposer(base) == transpose(base)
@test brief(base) == &quot;3 x 4 x Float64 in Columns (ReadOnly, Dense)&quot;
@test brief(transpose(base)) == &quot;4 x 3 x Float64 in Rows (Transpose, ReadOnly, Dense)&quot;
@test brief(transposer(base)) == &quot;4 x 3 x Float64 in Columns (Dense)&quot;

# Sparse

using SparseArrays

base = SparseMatrixCSC([0.0 1.0 2.0; 3.0 4.0 0.0])
@test transposer(base) == transpose(base)
@test brief(base) == &quot;2 x 3 x Float64 in Columns (Sparse Int64 67%)&quot;
@test brief(transpose(base)) == &quot;3 x 2 x Float64 in Rows (Transpose, Sparse Int64 67%)&quot;
@test brief(transposer(base)) == &quot;3 x 2 x Float64 in Columns (Sparse Int64 67%)&quot;

println(&quot;OK&quot;)

# output

OK
</code>
</pre>
</div>
</section>
</article>
<article class="docstring">
<header>
<a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring">
</a>
<a class="docstring-binding" id="TanayLabUtilities.MatrixLayouts.@assert_vector" href="#TanayLabUtilities.MatrixLayouts.@assert_vector">
<code>TanayLabUtilities.MatrixLayouts.@assert_vector
</code>
</a> — 
<span class="docstring-category">Macro
</span>
<span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring">
</span>
</header>
<section>
<div>
<pre>
<code class="language-julia hljs">@assert_vector(vector::Any, [n_elements::Integer])
</code>
</pre>
<p>Assert that the 
<code>vector
</code> is an 
<code>AbstractVector
</code> and optionally that it has 
<code>n_elements
</code>, with a friendly error message if it fails.
</p>
<pre>
<code class="language-julia hljs">vector = [0, 1, 2]

@assert_vector(vector)
n_elements = 3
@assert_vector(vector, n_elements)
m_elements = 2
@assert_vector(vector, m_elements)

# output

ERROR: wrong size: 3
of the vector: vector
is different from m_elements: 2
</code>
</pre>
<pre>
<code class="language-julia hljs">scalar = 1
@assert_vector(scalar)

# output

ERROR: non-vector scalar: 1
</code>
</pre>
</div>
</section>
</article>
<article class="docstring">
<header>
<a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring">
</a>
<a class="docstring-binding" id="TanayLabUtilities.MatrixLayouts.@assert_matrix" href="#TanayLabUtilities.MatrixLayouts.@assert_matrix">
<code>TanayLabUtilities.MatrixLayouts.@assert_matrix
</code>
</a> — 
<span class="docstring-category">Macro
</span>
<span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring">
</span>
</header>
<section>
<div>
<pre>
<code class="language-julia hljs">@assert_matrix(matrix::Any, [n_rows::Integer, n_columns::Integer], [major_axis::Int8])
</code>
</pre>
<p>Assert that the 
<code>matrix
</code> is an 
<code>AbstractMatrix
</code> and optionally that it has 
<code>n_rows
</code> and 
<code>n_columns
</code>. If the 
<code>major_axis
</code> is given, and does not match the matrix, invokes the 
<a href="matrix_layouts.html#TanayLabUtilities.MatrixLayouts.GLOBAL_INEFFICIENT_ACTION_HANDLER">
<code>GLOBAL_INEFFICIENT_ACTION_HANDLER
</code>
</a>.
</p>
<pre>
<code class="language-julia hljs">matrix = [0 1 2; 3 4 0]

@assert_matrix(matrix)
n_rows, n_columns = (2, 3)
@assert_matrix(matrix, Columns)
@assert_matrix(matrix, n_rows, n_columns)
@assert_matrix(matrix, n_rows, n_columns, Columns)

m_rows, m_columns = (3, 2)
@assert_matrix(matrix, m_rows, m_columns)

# output

ERROR: wrong size: (2, 3)
of the matrix: matrix
is different from (m_rows, m_columns): (3, 2)
</code>
</pre>
<pre>
<code class="language-julia hljs">matrix = [0 1 2; 3 4 0]

TanayLabUtilities.MatrixLayouts.GLOBAL_INEFFICIENT_ACTION_HANDLER = IgnoreHandler

@assert_matrix(matrix, Rows)

TanayLabUtilities.MatrixLayouts.GLOBAL_INEFFICIENT_ACTION_HANDLER = ErrorHandler

@assert_matrix(matrix, Rows)

# output

ERROR: inefficient major axis: Columns
for matrix: 2 x 3 x Int64 in Columns (Dense)
</code>
</pre>
</div>
</section>
</article>
<article class="docstring">
<header>
<a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring">
</a>
<a class="docstring-binding" id="TanayLabUtilities.MatrixLayouts.GLOBAL_INEFFICIENT_ACTION_HANDLER" href="#TanayLabUtilities.MatrixLayouts.GLOBAL_INEFFICIENT_ACTION_HANDLER">
<code>TanayLabUtilities.MatrixLayouts.GLOBAL_INEFFICIENT_ACTION_HANDLER
</code>
</a> — 
<span class="docstring-category">Constant
</span>
<span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring">
</span>
</header>
<section>
<div>
<p>The 
<a href="handlers.html#TanayLabUtilities.Handlers.AbnormalHandler">
<code>AbnormalHandler
</code>
</a> to use when accessing a matrix in an inefficient way (&quot;against the grain&quot;). Returns the previous handler. The default handler is 
<code>WarnHandler
</code>.
</p>
</div>
</section>
</article>
<h2 id="Index">
<a class="docs-heading-anchor" href="#Index">Index
</a>
<a id="Index-1">
</a>
<a class="docs-heading-anchor-permalink" href="#Index" title="Permalink">
</a>
</h2>
<ul>
<li>
<a href="matrix_layouts.html#TanayLabUtilities.MatrixLayouts">
<code>TanayLabUtilities.MatrixLayouts
</code>
</a>
</li>
<li>
<a href="matrix_layouts.html#TanayLabUtilities.MatrixLayouts.Columns">
<code>TanayLabUtilities.MatrixLayouts.Columns
</code>
</a>
</li>
<li>
<a href="matrix_layouts.html#TanayLabUtilities.MatrixLayouts.GLOBAL_INEFFICIENT_ACTION_HANDLER">
<code>TanayLabUtilities.MatrixLayouts.GLOBAL_INEFFICIENT_ACTION_HANDLER
</code>
</a>
</li>
<li>
<a href="matrix_layouts.html#TanayLabUtilities.MatrixLayouts.Rows">
<code>TanayLabUtilities.MatrixLayouts.Rows
</code>
</a>
</li>
<li>
<a href="matrix_layouts.html#TanayLabUtilities.MatrixLayouts.axis_name">
<code>TanayLabUtilities.MatrixLayouts.axis_name
</code>
</a>
</li>
<li>
<a href="matrix_layouts.html#TanayLabUtilities.MatrixLayouts.major_axis">
<code>TanayLabUtilities.MatrixLayouts.major_axis
</code>
</a>
</li>
<li>
<a href="matrix_layouts.html#TanayLabUtilities.MatrixLayouts.minor_axis">
<code>TanayLabUtilities.MatrixLayouts.minor_axis
</code>
</a>
</li>
<li>
<a href="matrix_layouts.html#TanayLabUtilities.MatrixLayouts.other_axis">
<code>TanayLabUtilities.MatrixLayouts.other_axis
</code>
</a>
</li>
<li>
<a href="matrix_layouts.html#TanayLabUtilities.MatrixLayouts.relayout">
<code>TanayLabUtilities.MatrixLayouts.relayout
</code>
</a>
</li>
<li>
<a href="matrix_layouts.html#TanayLabUtilities.MatrixLayouts.relayout!">
<code>TanayLabUtilities.MatrixLayouts.relayout!
</code>
</a>
</li>
<li>
<a href="matrix_layouts.html#TanayLabUtilities.MatrixLayouts.require_major_axis">
<code>TanayLabUtilities.MatrixLayouts.require_major_axis
</code>
</a>
</li>
<li>
<a href="matrix_layouts.html#TanayLabUtilities.MatrixLayouts.require_minor_axis">
<code>TanayLabUtilities.MatrixLayouts.require_minor_axis
</code>
</a>
</li>
<li>
<a href="matrix_layouts.html#TanayLabUtilities.MatrixLayouts.transposer">
<code>TanayLabUtilities.MatrixLayouts.transposer
</code>
</a>
</li>
<li>
<a href="matrix_layouts.html#TanayLabUtilities.MatrixLayouts.@assert_matrix">
<code>TanayLabUtilities.MatrixLayouts.@assert_matrix
</code>
</a>
</li>
<li>
<a href="matrix_layouts.html#TanayLabUtilities.MatrixLayouts.@assert_vector">
<code>TanayLabUtilities.MatrixLayouts.@assert_vector
</code>
</a>
</li>
</ul>
</article>
<nav class="docs-footer">
<p class="footer-message">Powered by 
<a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl
</a> and the 
<a href="https://julialang.org/">Julia Programming Language
</a>.
</p>
</nav>
</div>
<div class="modal" id="documenter-settings">
<div class="modal-background">
</div>
<div class="modal-card">
<header class="modal-card-head">
<p class="modal-card-title">Settings
</p>
<button class="delete">
</button>
</header>
<section class="modal-card-body">
<p>
<label class="label">Theme
</label>
<div class="select">
<select id="documenter-themepicker">
<option value="auto">Automatic (OS)
</option>
<option value="documenter-light">documenter-light
</option>
<option value="documenter-dark">documenter-dark
</option>
<option value="catppuccin-latte">catppuccin-latte
</option>
<option value="catppuccin-frappe">catppuccin-frappe
</option>
<option value="catppuccin-macchiato">catppuccin-macchiato
</option>
<option value="catppuccin-mocha">catppuccin-mocha
</option>
</select>
</div>
</p>
<hr/>
<p>This document was generated with 
<a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl
</a> version 1.12.0. Using Julia version 1.11.5.
</p>
</section>
<footer class="modal-card-foot">
</footer>
</div>
</div>
</div>
</body>
</html>
